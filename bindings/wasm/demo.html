<!doctype html>
<html>
  <body>
    <h1>ZKProv WASI Demo</h1>
    <pre id="out">loadingâ€¦</pre>
    <script type="module">
      import { init } from './loader.js';

      // We need a WASI polyfill in the browser; loader.js imports @wasmer/wasi via unpkg.
      const z = await init({ wasmPath: './zkprov_wasi.wasm' });

      const cfg = {
        backendId: 'native@0.0',
        field: 'Prime254',
        hashId: 'blake3',
        friArity: 2,
        profileId: 'balanced',
        airPath: '/work/examples/air/toy.air',
        publicInputsJson: '{"demo":true,"n":7}'
      };

      const out = document.getElementById('out');
      try {
        const backs = await z.listBackends();
        out.textContent = 'backends: ' + JSON.stringify(backs) + '\n';
        const airBytes = await fetch('./examples/air/toy.air').then((r) => r.arrayBuffer());
        const { proof, meta } = await z.proveFromBuffers(cfg, airBytes, '{"demo":true,"n":7}');
        out.textContent += `D=${meta.digest} len=${meta.proof_len}\n`;
        const vr = await z.verifyFromBuffers(cfg, airBytes, '{"demo":true,"n":7}', proof);
        out.textContent += `verified=${vr.verified} D=${vr.meta.digest}\n`;
      } catch (e) {
        out.textContent += 'ERROR: ' + e;
      }
    </script>
  </body>
</html>
